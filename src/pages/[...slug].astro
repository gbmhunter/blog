---
// @ts-nocheck
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import { getCollection } from 'astro:content';

import Aside from 'src/components/Aside.astro';
import ChildPages from 'src/components/ChildPages.astro';
import CircuitJs from 'src/components/CircuitJs.astro';
import Image from 'src/components/Image.astro';
import WarningIsNotes from 'src/components/WarningIsNotes.astro';

import { getRoutablePages, getSidebarData } from 'src/js/PageHierarchy';
import { correctUpdatesSlugs, getAllCollections } from 'src/js/Collections';

export async function getStaticPaths() {
  // let pagesCollection = await getCollection('pages');
  // pagesCollection = [];

  // All pages in the updates collection will have a slug prefixed with "updates/"
  // let updatesCollection = await getCollection('updates');
  // correctUpdatesSlugs(updatesCollection);

  // Merge the updates collection into the pages collection
  // const combinedCollection = (pagesCollection as any).concat(updatesCollection);

  const combinedCollection = await getAllCollections();


  // Uncomment this line if you want to test code logic with a smaller collection
  // let pagesCollection = await getCollection('test');
  
  // Trim down to first 10
  // pagesCollection = pagesCollection.slice(0, 2);

  const routablePages = getRoutablePages(combinedCollection);
  const sidebarData = getSidebarData(combinedCollection);

  let staticPaths = [];
  for (let pageRoute of routablePages) {

    if (pageRoute.slug === 'index') {
      pageRoute.slug = undefined;
    }

    staticPaths.push({
      params: { slug: pageRoute.slug },
      props: { 
        title: pageRoute.data.title,
        render: pageRoute.render,
        sidebarData: sidebarData,
        image: pageRoute.data.image,
      },
    });
  }

  return staticPaths;
}

const { title, render, sidebarData, image } = Astro.props;
const { Content, headings, remarkPluginFrontmatter } = await render();

---
<!-- // @ts-ignore -->
<StarlightPage frontmatter={{ title: title }} headings={headings} sidebar={sidebarData.items as any} image={image}>
  <Content components={{
    Aside: Aside,
    ChildPages: ChildPages,
    CircuitJs: CircuitJs,
    Image: Image,
    WarningIsNotes: WarningIsNotes
  }} /> 
</StarlightPage>