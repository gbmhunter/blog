---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import { getCollection } from 'astro:content';

import { getRoutablePages, getSidebarData } from '../PageHierarchy.ts';

export async function getStaticPaths() {
  console.log('====================================================');
  console.log('getStaticPaths');
  console.log('====================================================');


  let pagesCollection = await getCollection('docs2');
  // Trim down to first 10
  // pagesCollection = pagesCollection.slice(0, 2);

  const routablePages = getRoutablePages(pagesCollection);
  const sidebarData = getSidebarData(pagesCollection);

  let staticPaths = [];
  for (let pageRoute of routablePages) {

    if (pageRoute.slug === 'index') {
      pageRoute.slug = undefined;
    }

    staticPaths.push({
      params: { slug: pageRoute.slug },
      props: { 
        title: pageRoute.data.title,
        render: pageRoute.render,
        sidebarData: sidebarData,
      },
    });
  }

  return staticPaths;
}

const { title, render, sidebarData } = Astro.props;
const { Content, headings, remarkPluginFrontmatter } = await render();
---
<StarlightPage frontmatter={{ title: title }} headings={headings} sidebar={sidebarData.items as any}>
  <Content /> 
</StarlightPage>