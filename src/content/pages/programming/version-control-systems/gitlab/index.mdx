---
authors: [gbmhunter]
date: 2014-02-08
description: GitLab is a web-based Git repository manager and a strong competitor to GitHub, especially for commercial uses. The page covers container registries, pipeline includes, and running pipelines locally using gitlab-ci-local.
image: ./_assets/cover-image.webp
lastUpdated: 2024-10-14
tags: [GitLab, Git, version control, CI/CD, continuous integration, continuous deployment, yaml, container registry, local pipelines, GCL]
title: GitLab
type: page
---

GitLab is a web-based "dev ops" software system that provides Git server based hosting, bug tracking, CICD and more for software projects. It is a strong competitor to GitHub, especially for commercial uses.

<Image src={import('./_assets/cover-image.webp')} width="500px">The GitLab logo[^gitlab-our-new-logo].</Image>

## Container Registries

Each repo can have it's own container registry. You can use this to store Docker images relating to the project.

`CI_REGISTRY_IMAGE` is provided and is the base path for the container registry.

You can log into the repo's container registry inside a pipeline with the command:

```bash
echo $CI_REGISTRY_PASSWORD | docker login -u $CI_REGISTRY_USER $CI_REGISTRY --password-stdin
```

Then you be able to push a built image:

```bash
docker push "$CI_REGISTRY_IMAGE"
```

You can download images from the GitLab container registry to your local machine by first logging in:

```bash
docker login registry.gitlab.com
```

You will be prompted to enter your username and password. If you have 2FA enabled, you will have to substitute your password with a personal access token.

You can then download and run an image with:

```bash
docker run -it registry.gitlab.com/<org_name>/<project_path> bash
```

### GitLab CI Files

### Includes

You can include files in your `.gitlab-ci.yml` file with the `include` keyword. This is useful for sharing common configuration between multiple projects.

```yaml
include:
  - project: 'my-group/my-project'
    file: '/path/to/file.yml'
```

You can also use the `ref` to specify a branch, tag or commit SHA when including a file. This is good for "version control" of your include dependencies.

```yaml
include:
  - project: 'my-group/my-project'
    ref: 'main' # Branch name
    file: '/path/to/file.yml'
  - project: 'my-group/my-project'
    ref: 'v1.0.0' # Tag name
    file: '/path/to/file.yml'
  - project: 'my-group/my-project'
    ref: 'b6901dcb0918db67a81b190d24fa67f0b5f99fdb' # Commit SHA
    file: '/path/to/file.yml'
```

## Running Pipelines Locally

GitLab does not have official support for running pipelines locally, but there is a popular third-party tool called [gitlab-ci-local](https://github.com/firecow/gitlab-ci-local) (a.k.a. GCL) which allows you to do this.

### Installation

To install `gitlab-ci-local` on Debian-based UNIX distributions (e.g. Ubuntu), you can run the following command[^github-repo-gitlab-ci-local]:

```bash
sudo wget -O /etc/apt/sources.list.d/gitlab-ci-local.sources https://gitlab-ci-local-ppa.firecow.dk/gitlab-ci-local.sources
sudo apt-get update
sudo apt-get install gitlab-ci-local
```

### Running a Job

Clone the repository that contains the pipeline (i.e. has a `.gitlab-ci.yml` file) and run the following command:

```bash
gitlab-ci-local <job_name>
```

This will run the job locally and output the results to the console. You may need authentication for the job to run successfully, see the section below for details.

However, this will not run the job's dependencies, which might be what you were expecting. To run the job and all of it's dependencies, add the `--needs` flag:

```bash
gitlab-ci-local <job_name> --needs
```

`gitlab-ci-local` will cache the "dot env" of dependencies, so you don't need to keep using `--needs` during testing if the dependencies haven't changed. By default, `gitlab-ci-local` stores the cache of the artifacts at `.gitlab-ci-local/artifacts/<job_name>`. This is quite a convenient place to check if you need to debug a job.

### Authentication

Normal pipelines that are run on GitLab's servers get provided with a `CI_JOB_TOKEN` which can be used to authenticate when pulling submodules that are other private GitLab repositories, or when pulling/pushing to the GitLab container registry. To authenticate when running locally, you can create a file called `.gitlab-ci-local-variables.yml` in the root directory of the repository with the following contents:

```yaml title=".gitlab-ci-local-variables.yml"
---
CI_JOB_TOKEN: <your_personal_access_token>
```

Do not commit this file to the repository! Make sure to add it to your `.gitignore` file.

### Manual Jobs

You can trigger a manual job to run during the execution of another job with `--manual <job_name>`. For example:

```bash
gitlab-ci-local build_firmware --manual my_manual_job
```

### Watch Out For Untracked Files

GCL will not sync local files that are not tracked by Git. So if you are playing around and add a completely new file, you might run into a "file not found" error when running your pipeline. To fix this, all you need to do is run `git add ...` to stage the file in git (it doesn't need to be committed)[^github-repo-gitlab-ci-local].

The file does not need to be continuously re-added to the git staging area when changes are made, as long as the file has been staged (or committed) at least once.

{/* ======================================================================== */}
{/* REFERENCES */}
{/* ======================================================================== */}

[^github-repo-gitlab-ci-local]: GitHub. _firecow/gitlab-ci-local_ [repo README]. Retrieved 2024-10-02, from https://github.com/firecow/gitlab-ci-local.
[^gitlab-our-new-logo]: GitLab (2015, Jul 3). _Our new logo_ [blog post]. Retrieved 2024-10-14, from https://about.gitlab.com/blog/2015/07/03/our-new-logo/.
