---
import type { Props } from '@astrojs/starlight/props';
import StarlightHead from '@astrojs/starlight/components/Head.astro';
import VtbotStarlight from 'astro-vtbot/components/starlight/Base.astro';

if (Astro.props.entry.slug === 'test') {
  console.log('Astro.props: ', Astro.props.image);
}

let imageSrc = '';
if (Astro.props.image !== undefined && Astro.props.image !== null) {
  // Ignore ts
  // @ts-ignore
  imageSrc = Astro.props.image.src;
} else {
  imageSrc = 'https://vtbot.com/images/vtbot-logo.png';
}
console.log('imageSrc: ', imageSrc);
---


<VtbotStarlight {...Astro.props}>
  <meta property="og:image" content={imageSrc} />
  <meta name="twitter:image" content={imageSrc} />
  <StarlightHead {...Astro.props}><slot /></StarlightHead>
</VtbotStarlight>

<script>
  // console.log('location.href: ', location.href);
  // console.log('location.pathname: ', location.pathname);
  // console.log('location.pathname: ', location.pathname);

  configureSidebar();

  function configureSidebar() {
    const sidebarContent = document.getElementsByClassName('sidebar-content')[0];
    // console.log('sidebarContent: ', sidebarContent);

    const link = sidebarContent.querySelectorAll(`a[href="${location.pathname}"]`)[0];
    // console.log('link: ', link);

    // This makes the current page link have a different background color
    link.setAttribute('aria-current', 'page');

    // Link could be undefined if the current page is not in the sidebar, for example,
    // the homepage
    if (link === undefined) {
      // console.log('link is undefined');
      return
    }

    // Find <details ...> parents of <a href="/electronics/"> elements
    // Setting the open attribute (to anything, just has to be present) makes
    // that menu group open
    let currElement = link.closest('details');
    while (true) {
      // console.log('currElement: ', currElement);
      if (!currElement) {
        break;
      }
      if (!sidebarContent.contains(currElement)) {
        break;
      }
      currElement.setAttribute('open', '');
      currElement = currElement.parentElement!.closest('details');

    }
  }

</script>