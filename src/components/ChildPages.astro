---
import { LinkCard, CardGrid } from '@astrojs/starlight/components';
// import { getImage, Image } from "astro:assets";

// import { pageGlob, pageNodes } from '../PageHierarchy.ts';

import { getCollection, getEntry } from 'astro:content';

const pagesCollection = await getCollection('docs2');
// console.log(allBlogPosts);

let pageSlug = Astro.params.slug; // e.g. electronics/circuit-design
if (pageSlug === undefined) {
  // Will be undefined if homepage (root index.mdx)
  pageSlug = '';
} else {
  pageSlug = pageSlug + '/';
}

let count = 0;
let childPages: any = [];
for (const page of pagesCollection) {
  // console.log(page);
  if (count > 9900) {
    break;
  }
  count++;

  // Check slug matches regex
  // console.log('Checking slug:', page.slug);
  // console.log('curr page slug:', pageSlug);
  const regex = new RegExp(`^${pageSlug}[^\/]*$`);
  // console.log('regex:', regex);
  const match = page.slug.match(regex);
  if (match === null) {
    // console.log('No match');
    continue;
  }
  // console.log('Found match:', match);
  childPages.push(page);
}
// console.log('Child pages:', childPages);

// console.log(Astro.params); // slug: electronics/circuit-design
// console.log(Astro.url); // pathaame: /electronics/circuit-design/
---

<CardGrid>
  {
    childPages.map((childPage: any) => (
      <LinkCard title={childPage.data.title} href={'/' + childPage.slug + '/'} description={childPage.data.description} />
    ))
  }
</CardGrid>
