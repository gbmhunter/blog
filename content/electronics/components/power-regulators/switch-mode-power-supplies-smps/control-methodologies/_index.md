---
authors: [ Geoffrey Hunter ]
categories: [ Electronics, Electronic Components, Power Regulators ]
date: 2023-06-18
description: Voltage mode control, peak current mode control, feedback circuits, compensation, schematics and more info on SMPS control methodologies.
draft: false
images: [ /electronics/components/power-regulators/switch-mode-power-supplies-smps/control-methodologies/peak-current-mode-control-diagram.webp ]
lastmod: 2023-06-19
tags: [ electronics, components, power regulators, SMPS, voltage mode control, current mode control, peak current mode control, buck converter, feedback, poles, zeroes ]
title: SMPS Control Methodologies
type: page
---

{{% warning-is-notes %}}

## Overview

Switching power supplies (PSUs) generally have to have some sort of feedback-based control loop to regulate the output to the desired voltage (or current). This is called the _control methodology_. There are a few important types of control methodologies that we will cover on this page.

{{% aside type="info" %}}
Although most of the examples on this page use a buck converter, the control methodologies are similarly applicable to other topologies such as boost converters.
{{% /aside %}}

## Voltage Mode Control

_Voltage mode control_ (a.k.a. duty-cycle control[^ti-slva636-feedback-loop-analysis-current-mode-boost-converter]) uses a scaled version of the output voltage (e.g. resistor divider) as the feedback.

One big disadvantage of voltage mode control is that the SMPS can only respond to changes once it senses a error in the output voltage and propagates through the entire feedback path. This can lead an unacceptably slow response in systems with fast transients[^ti-sboa187e-current-mode-control].

Another problem with voltage mode control is that the feedback compensation is relatively complex, there are two poles that need addressing. The feedback compensation is also dependent on the input voltage[^ti-sboa187e-current-mode-control].

## Current Mode Control

_Current mode control_ (a.k.a. _current-programmed mode_, _current-injected control_[^ti-slva636-feedback-loop-analysis-current-mode-boost-converter]) was introduced to the power electronics community in the early 1980s[^ti-slva636-feedback-loop-analysis-current-mode-boost-converter] and attempts to improve on some of voltage mode controls shortcomings by adding a second, "inner" and fast feedback loop by monitoring the inductor current. The outer feedback loop monitoring the output voltage (like in voltage mode control) is still present (we still need to know what our target is), but rather than this controlling the switch, the output voltage feedback is passed to the current feedback, and the output of the current feedback is what controls the switch.

These two feedback systems make up an _inner_ and _outer_ feedback loop:

* Inner loop: Sets the ON time of the switching cycle based on the sensed inductor/switch current.
* Outer loop: Sets the control input of the inner loop based on the output voltage.

### Peak Current Mode Control

_Peak Current Mode Control_ (PCMC) is a specific type of current mode control which **senses the peak current flowing through the inductor**. The peak current through the inductor (and consequentially, the switch) is limited by a control signal `\(i_C (t)\)` which in turn is generated by amplifying the difference between the output voltage feedback and the reference voltage `\(V_{REF}\)`.

The below diagram shows what this looks like during continuous conduction:

{{% figure src="peak-current-mode-control-waveforms.webp" width="600px" %}}

The following diagram shows the basic components of peak current mode control for a buck converter:

{{% figure src="peak-current-mode-control-diagram.webp" width="900px" caption="Block diagram showing the basics of peak current mode control for a buck converter." %}}

{{% aside type="warning" %}}
It's important to notice that the left-hand "op-amp" symbol is an analogue amplifier (output is equal to the difference in the inputs, multiplied by a gain) but the right-hand "op-amp" symbol is a comparator (comparator output is either high or low depending on the sign of the difference in the inputs).
{{% /aside %}}

One benefit from controlling the peak current is that we can easily limit the maximum current through the inductor by limiting the maximum value that the control signal `\(i_C(t)\)` can ever be. We might want to do this to make sure the inductor current never exceeds it's maximum rating (usually the minimum of it's [saturation current](/electronics/components/inductors/#saturation-current) or [rated current](/electronics/components/inductors/#rated-current)).

**How Does This Circuit Work?**

1. The feedback voltage from the output resistor divider is compared to `\(V_{REF}\)`. The difference is amplified by the voltage feedback op-amp and fed into the comparator. This is compared with a voltage proportional to the inductor current.
1. At the beginning of a cycle, a short clock pulse sets the output of the SR latch. This turns on the main switch (usually a MOSFET) and the current through the inductor begins rising.
1. The inductor current continues to rise until the the voltage at the `\(+\)` terminal of `\(U2\)` becomes greater than the voltage output from `\(U1\)`. At this point the comparator output goes HIGH and resets the SR latch. Thus the ON part of the cycle finishes, and the switch is turned OFF until another clock pulse arrives at the beginning of the next switching cycle.

Bootstrap/MOSFET drive circuitry is usually needed between the SR latch and the MOSFET to:

1. Provide enough current to switch the MOSFET quickly.
1. If a N-channel MOSFET is used, a charge-pump is needed to provided a voltage rail above `\(V_{IN}\)` to drive the gate when turning it on.

Many off-the-shelf ICs will contain both the switch and the current-sensing directly in the IC, removing the need for a separate `\(R_{SENSE}\)` and associated differential amplifier to measure the current.

Peak current-mode control can experience subharmonic oscillation. Ramp compensation is usually added to address this issue[^ti-slva636-feedback-loop-analysis-current-mode-boost-converter].

#### Noise Issues and Blanking Intervals

Because the switching action causes noise, and the current-measuring voltage signal is usually low (because low-valued resistors are used to keep power dissipation down), current mode control has a high susceptibility to noise and voltage transients[^ti-sboa187e-current-mode-control] [^university-of-colorado-bolder-intro-to-peak-current-mode-control]. The switching action can cause ringing in the voltage measurement of the current at the point of turn on. This ringing can cause the measured signal to go over the control threshold and prematurely turn the switch OFF, as shown in the below diagram:

{{% figure src="peak-current-mode-control-noise.webp" width="500px" caption="Diagram showing how switching noise can prematurely turn the switch OFF, and how a blanking interval can be used to improve the noise immunity." %}}

One way to compensate for this is to add in a _blanking interval_. This is a short interval that begins at switch turn-on in which the output of the current feedback comparator is ignored[^university-of-colorado-bolder-intro-to-peak-current-mode-control]. This improves the current mode controls noise immunity.

## Further Reading

The YouTube video [Introduction to Peak Current Mode Control by the University of Colorado Bolder](https://www.youtube.com/watch?v=3tTSMDEyVKc) is a great visual explanation of how current-mode control works in SMPS[^university-of-colorado-bolder-intro-to-peak-current-mode-control].

{{% figure src="university-of-colorado-boulder-peak-current-mode-control-screenshot.png" width="600px" caption="Screenshot of the YouTube video \"Introduction to Peak Current Mode Control\" by the University of Colorado Bolder[^university-of-colorado-bolder-intro-to-peak-current-mode-control]." %}}

If you want to get right into the control theory of current-mode control, the [Texas Instruments Understanding and Applying Current-Mode Control Theory](https://www.ti.com/lit/an/snva555/snva555.pdf) is a recommended read[^ti-snva555-current-mode-control-theory].

## References

[^ti-sboa187e-current-mode-control]: Texas Instruments (2020, Dec). _Application Brief - Current Mode Control in Switching Power Supplies_. Retrieved 2023-06-18, from https://www.ti.com/lit/an/sboa187e/sboa187e.pdf.
[^university-of-colorado-bolder-intro-to-peak-current-mode-control]: University of Colorado Bolder (2020, Aug 7). _Introduction to Peak Current Mode Control (video)_. YouTube. Retrieved 2023-06-18, from https://www.youtube.com/watch?v=3tTSMDEyVKc.
[^ti-snva555-current-mode-control-theory]: Texas Instruments (2007, Oct 31). _Understanding and Applying Current-Mode Control Theory_. Retrieved 2023-06-18, from https://www.ti.com/lit/an/snva555/snva555.pdf.
[^ti-slva636-feedback-loop-analysis-current-mode-boost-converter]: SW Lee (2014, Mar). _SLVA636 - Application Report - Practical Feedback Loop Analysis for Current-Mode Boost Converter_. Texas Instruments. Retrieved 2023-06-19, from https://www.ti.com/lit/an/slva636/slva636.pdf.
