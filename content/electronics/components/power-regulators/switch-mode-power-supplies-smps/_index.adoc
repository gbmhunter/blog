---
authors: [ "Geoffrey Hunter" ]
categories: [ "Electronics", "Electronic Components", "Power Regulators" ]
date: 2015-03-24
description: "Topologies (buck, boost, buck-boost, SEPIC, Ćuk), control methods, component selection, equations, operation modes, schematics, examples and more info on switch-mode power supplies."
draft: false
images: [ "/electronics/components/power-regulators/switch-mode-power-supplies-smps/smps-buck-converter-simple.png" ]
lastmod: 2021-08-19
tags: [ "electronics", "components", "power regulators", "SMPS", "buck converter", "power electronics", "inductor", "capacitor", "regulation", "control methods", "constant frequency", "current-mode", "SNVA555", "PCM", "peak current mode", "CCM", "constant current mode", "SEPIC", "Cuk", "Ćuk" ]
title: "Switch Mode Power Supplies (SMPS)"
type: "page"
---

== Overview

_Switch-mode power supplies_ (SMPS) are power conversion circuits that **efficiently convert input voltages/currents (power) into different output voltages/currents**. This page only looks at non-isolated SMPSs, i.e. topologies that don't use a transformer. They can either:

* Decrease the voltage (<<Buck Converters, buck converter>>)
* Increase the voltage (<<Boost Converters, boost converter>>)
* Increase or decrease the voltage (buck-boost, <<SEPIC, SEPIC>>, <<Ćuk Converter, Ćuk Converter>>)
* Increase or decrease AND invert the voltage (<<Inverting Buck-Boost Converters, inverting buck-noost converter>>)

Unlike linear regulators which act as a dynamic series resistance to dump energy as heat and produce a lower output voltage, **SMPSs efficiently perform voltage conversion by storing energy in the magnetic field of an inductor and electric field of a capacitor** (and are not limited to just producing lower output voltages, they can produce higher output voltages also).

== Buck Converters

=== Overview

Buck converters use a switching element, inductor and capacitor to convert an input voltage into a **lower** output voltage. It is a type of _switch-mode power supply_ (SMPS).

.The basic schematic of a buck converter. SW1 is typically a MOSFET switched by control logic (not shown).
image::buck-converter-basic-schematic.svg[width=600px]

The output voltage of a buck converter is purely determined by the input voltage stem:[V_{IN}] and the percentage of time that the switch spend on during each switching cycle, stem:[D]:

[stem]
++++
\begin{align}
V_{OUT} = DV_{IN}
\end{align}
++++

NOTE: The simple equation showing stem:[V_{OUT}] is only dependent on stem:[V_{IN}] and stem:[D] is only true when all components act ideally (e.g. no voltage drop across the diode, no ESR in the capacitor, no resistance through the inductor). In the real world this is never true, however this equation is still a good first approximation.

When using a P-channel MOSFET for synchronous rectification, it's body diode is forward-biased when the converter is in shutdown mode. This can **drain the power source** into the output. More advanced buck converters have extra circuitry to disconnect this P-channel MOSFET when the device is not active.

=== Control Methods

Almost all control methods aim to regulate the output voltage.

==== Constant Frequency, Current-Mode Control

Constant frequency, current-mode control is a very common control method for buck converters. It has the benefits of:

* Permitting smaller output capacitances
* Simplifying the external frequency compensation

Peak current measurement is a common way of "measuring" the average output current.

A transconductance amplifier (amplifier that converts a input voltage to an output current) is used to compare the voltage at a feedback pin (typically labelled _FB_) to an internal voltage reference.

PCM: Peak current mode

See the excellent link:https://www.ti.com.cn/cn/lit/an/snva555/snva555.pdf[SNVA555: Understanding and Applying Current-Mode Control Theory] by TI for more information on current-mode control theory.

=== Inductor Selection

You can use the following equations to select the main inductor for a buck converter.

First, calculate the maximum average inductor current using:

[stem]
++++
I_L = I_{OUT} \frac{V_{OUT}}{0.8 V_{IN}}
++++

[.text-center]
where: +
stem:[V_{IN}] = the input voltage to the buck regulator +
stem:[V_{OUT}] = the output voltage of the buck regulator

Then, calculate the value of inductance required with:

[stem]
++++
L = \frac{V_{IN} (V_{OUT} - V_{IN})}{\Delta I_L \cdot f \cdot V_{OUT}}
++++

[.text-center]
where: +
stem:[\Delta I_L] = the desired ripple current in the inductor +
stem:[f] = the switching frequency +
and everything else as mentioned previously

==== Types Of Inductors

Inductors used for buck converters can generally be classified into one of three different types:

. **Wire-wound ferrite core**: Copper wound around a ferrite core.

. **Metal composite**: Metal powders moulded around copper windings at high pressure.
+
.Internal construction of a metal composite inductor. Image by Kemet, retrieved from https://media.digikey.com/pdf/Data%20Sheets/Kemet%20PDFs/MPXV_Series_DS.pdf on 2020-11-30.
image::metal-composite-inductor-construction-kemet-mpx.png[width=300px]

. **Multilayer**: Laminated sheets.

The various advantages of each of explored in the following table:

[%autowidth]
|===
| Type                     | Inductance

| Wire-wound ferrite core  | High (up to 200uH)
| Metal composite          | Medium (up to 10uF)
| Multilayer               | Low (up to 1uH)
|===

=== Capacitor Selection

The output capacitance is primarily determined by the maximum allowed output voltage ripple. This ripple is determined by the capacitance of the capacitor and it's ESR (equivalent series resistance). The output capacitance of a boost converter can be found using the following equation.

[stem]
++++
C_{min} = \dfrac{I_O (V_{OUT} - V_{IN})}{f  \Delta V V_{OUT}}
++++

[.text-center]
where: +
stem:[\Delta V] = the maximum desired output voltage ripple +
and everything else as mentioned previously

The actual ripple will be slightly larger than this due to the ESR of the capacitor.

[stem]
++++
\Delta V_{ESR} = I_O R_{ESR}
++++

[.text-center]
where: +
stem:[R_{ESR}] = the parasitic series resistance of the output capacitor

The total output ripple is the sum of the ripple caused by the capacitance, and the ripple cause by the ESR. 

TIP: These equations assume a constant load. Load transients (fluctuations in the load current) will also cause voltage ripple.

=== Down Conversion

Some boost converters also have a built in regulator to provide regulation when the input voltage exceeds the desired output voltage. This is normally a linear regulator, so your efficiency will drop and you will have to take into account the thermal dissipation. This is normally called **down conversion**.

.The internal schematic of a boost converter with in-built down conversion capability (the ability to drop the input voltage).
image::schematic-of-boost-converter-with-down-conversion-capability.png[width=507px]

The price you pay for this added down conversion feature is a slightly higher cost, and slightly higher quiescent current (e.g. some of TI's boost converters have 19uA quiescent current without down conversion, and 25uA with down conversion).

=== Input Voltage Range

Typically, boost ICs with an internal switch (a converter) can support lower input voltages than those that require an external switch (a controller). A typical minimum input voltage for a converter is in the range 0.3-0.9V, while a controller's minimum is in the range 0.9-1.8V.

=== Buck Converter Calculator

You can find a buck converter calculator as part of link:http://ninja-calc.mbedded.ninja/buck-converter-calculator[mbedded.ninja's NinjaCalc web app].

.A screenshot of the buck converter calculator in NinjaCalc (as of v2.2.0).
image::ninja-calc-buck-converter-calculator-screenshot.png[width=956px]

=== Examples

==== Tiny (Nano) Buck Converters

Texas Instruments released a series of very small (3.5x3.5x1.8mm) buck converter modules in 2015. One of the most impressive features is that this includes the inductor (external capacitors are still required). One example is the LMZ20502, which can provide up to 2A of current with an input voltage range of 2.7-5.5V and a output voltage range of 0.8-3.6V.

.A photo of the LMZ20502 buck converter. Image from http://www.digikey.co.nz/product-detail/en/LMZ20502SILT/296-38656-1-ND/.
image::photo-of-lmz20502-buck-converter.jpg[width=306px]

Notice how most of the volume on the module is taken up the chip inductor (the big brown thing that dominates most of the image). The dimensions of the package are shown in the diagram below.

.The dimensions of the MicroSIP component package, used by the Texas Instruments 'Nano' buck converters. Image from http://www.ti.com/lit/ds/symlink/lmz20502.pdf.
image::microsip-component-package-dimensions.png[width=500px]

== SMPS Modes Of Operation

SMPS can work in different modes of operation:

* Continuous conduction mode (CCM)
* Discontinuous conduction mode (DCM)
* Critical conduction mode (CrCM)
* Burst-mode

We'll explain these a little in the following sub-sections before moving on to boost converters.

=== Continuous Conduction Mode (CCM)

_Continuous conduction mode_ (CCM) is when the **current through the inductor never falls to 0** during the switching cycle. In the case of converter with multiple inductors (e.g. link:#_sepic[SEPIC]), CCM is when the current never falls to 0 in any of the inductors.

For the same output current, the peak current through the inductor is lower when the SMPS is operating in CCM, compared on any other mode of operation.

CCM encounters turn-on losses through the switch. These can be exacerbated by the diodes reverse recover charge (stem:[ Q_{rr} ]). Ultra-fast diodes with low (stem:[Q_{rr}]) are therefore recommended.

=== Discontinuous Conduction Mode (DCM)

_Discontinuous conduction mode_ (DCM) is when the **current through the inductor falls to 0** (and stays there for a period of time) during a switching cycle of the SMPS.

The switch (lets assume a MOSFET) is turned on at zero current, which means there is little turn-on loss.

=== Critical Conduction Mode (CrCM)

Critical conduction mode (CrCM) is at the boundary between CCM and DCM. 

In CrCM, the peak inductor current is exactly twice the average value. This increases the switching element's RMS current and turn-off current.

CrCM is good for low to medium power boost converter designs. At higher power levels the low filtering ability and high peak inductor currents start to become disadvantageous. Above this point boost converters operating in CCM are more preferable.

=== Burst-Mode

Burst-mode is a favourite for saving power when the load needs very little current. In burst-mode operation, the regulator operates for a period of time, charges up the output capacitor to a set threshold, and then shuts down completely. When the output voltage sags below a set threshold, the converter turns back on and the cycle restarts. This works well when there is little load current and so the converter can "sleep" for a significant period of time before it has to turn on again.

When the converter enters sleep, a number of power consuming components of the SMPS control circuit can be disabled (e.g. oscillators, voltage references, op-amps), saving power.

=== Advanced Asynchronous Modulation (AAM)

AAM is not supported by all buck converters, and is a mode used at low output currents to reduce the power consumption of the SMPS.


== Boost Converters

=== Schematics

Boost converters use a switching element, inductor, diode, and capacitor to convert an input voltage stem:[V_{in}] into a higher or equal output voltage stem:[V_{out}].

.The basic schematic of a boost converter. SW1 is typically a MOSFET switched by control logic (not shown).
image::boost-converter-basic-schematic.svg[width=600px]

=== Design Procedure

==== Duty Cycle

The duty cycle for a boost converter is given by:

[stem]
++++
D = 1 - \eta \cdot \frac{V_{IN}}{V_{OUT}}
++++

As you can see, the duty cycle is dependent only on the ratio between the input and output voltages. This has to be one of the simplest boost converter equations. This equation ignores the specific voltage drops across the switching element and rectifier, but rather lumps them together into the efficiency term.

==== Inductance

The inductance can be determined using:

[stem]
++++
L = (\frac{V_{in}}{V_{out}})^2 \cdot (\frac{V_{out} - V_{in}}{I_{out} \cdot f_s}) \cdot (\frac{\eta I_L}{\Delta I_L})
++++

You don't know stem:[ I_L ] or stem:[ \Delta I_L ] yet, but the trick is here to assume a maximum inductor ripple current stem:[ \Delta I_L ] as a percentage of the average inductor current, stem:[ I_L ]. A rule-of-thumb is to assume a maximum ripple current of 35% (assuming it is operating in CCM mode). Thus,

[stem]
++++
\frac{\Delta I_L}{I_L} = 0.35
++++

Now the equation for the inductance becomes:

[stem]
++++
L = (\frac{V_{in}}{V_{out}})^2 \cdot (\frac{V_{out} - V_{in}}{I_{out} \cdot f_s}) \cdot (\frac{\eta }{0.35})
++++

which can be solved as we know all of the variables.

==== Output Current

The maximum output current is given by:

[stem]
++++
I_{OUT(max)} = (I_{SW(max)} - \frac{\Delta I_L}{2})(1 - D)
++++

==== Diode Selection

The maximum reverse voltage of the diode must be at least equal to the output voltage of the boost converter. This is because diode sees the full load voltage when the switch is closed (in a reverse-biased setup).

=== PCB Routing

The same rules apply for routing boost converters as with any SMPS. See the PCB Routing section on the SMPS page for more information.

=== Light Load Instabilities

Bad things can happen when boost converters are operated with light/no load. If the controller isn't smart enough to reduce the duty cycle down to near 0 when there is no or little load, the voltage across the capacitor can build up to a point where it causes damage to part of the circuitry.

Also, if the converter is in DCM and the load current suddenly increases, the output voltage can sag greatly.

=== Turning Off/Disabling

While most boost controllers have an enable/disable pin, this doesn't actually disconnect the input from output, as the switching device is not in series with input and output, as it is in a buck Converter. Thus if you need the load completely disconnected from the input, you will need to add something like a P-Channel MOSFET or load switch to the front-end of the boost converter.

=== Start-up vs. Runtime Minimum Input Voltage Requirements

Some boost converters have differing start-up and runtime minimum input voltage requirements. Typically, the boost converter requires a higher minimum input voltage to start (e.g. 18V), but once running, can run of a lower voltage (e.g. 500mV).

=== Bypass

Some boost converters designed for ultra-lower power applications have a **bypass mode**. When the output voltage is not needed to be higher than the input voltage, the converter enters a bypass mode in where most of the control circuitry is disabled, the converter stops switching, and the input voltage is "bypassed" straight to the output.

=== Max. Current Ratings

One gotcha: The "max. current" rating that a manufacturer will provide with a boost controller with an integrated switch will usually be the maximum current rating of the switch. **This is not the maximum output current**, but rather the maximum input current. The maximum output current, assuming you have a higher output voltage, will be less than this.

=== Compensation Loop

The compensation loop is part of the feedback mechanism. The below diagram shows a current-mode controlled boost converter with a transconductance amplifier (\( g_m \)) providing the feedback.

.A simplified diagram of a current-mode boost converter with a transconductance amplifier (gm). Image from Texas Instruments Application Report SLVA452 - Compensating the Current-Mode-Controlled Boost Converter.
image::simplified-diagram-current-mode-boost-converter-with-gm-amplifier.png[width=550px]

The above model is only valid for when the boost converter is acting like a current-mode controlled regulator. This is the case when the ripple current is within the normal operating region (0.2-0.4 times the average input current). When the inductor is oversized to further reduce current ripple through the inductor (less than 0.2 times the average input current), the boost converter behaves more like a voltage-mode controlled regulator and this above model is no longer valid.

External compensation can be added if the manufacturer provides a compensation pin (typically called COMP). The pin is the output of the internal transconductance amplifier.

.The external loop compensation components for the TPS61087 boost regulator. Image from the Texas Instruments TPS61087EVM User's Guide with annotations.
image::compensation-components-for-tps61087evm-boost-converter-annotated.png[width=870px]

A resistance between 5-100kR and a capacitance between 1-10nF is typical. A higher resistance corresponds to a faster response time. A lower capacitance corresponds to a higher phase margin.

== Inverting Buck-Boost Converters

An inverting buck-boost is a type of switch-mode power supply (SMPS) that converts an input voltage into a higher or lower output voltage. It is given the name inverting because it generates a negative output voltage.

.The basic schematic of a inverting buck-boost converter. SW1 is typically a MOSFET switched by control logic (not shown).
image::inverting-buck-boost-converter-basic-schematic.svg[width=600px]

=== Output Voltage

Again, the output voltage for an ideal SEPIC is purely determined by the input voltage and the duty cycle stem:[D], as given in the following equation:

[stem]
++++
\begin{align}
V_{OUT} = -\frac{D}{1 - D} V_{IN}
\end{align}
++++

To give you an idea of how varying the duty cycle can produce either a higher or lower output voltage, see <<vout-to-vin-vs-duty-cycle-buck-boost>> which shows how the output voltage can vary from a small fraction of stem:[V_{IN}] to many times larger than stem:[V_{IN}], and they are equal when the duty cycle is set at 50%.

[[vout-to-vin-vs-duty-cycle-buck-boost]]
.Relationship between duty cycle and the voltage ratio for a inverting buck-boost converter, ignoring the sign (so applicable for a SEPIC also). Dotted line drawn where stem:[V_{OUT} = V_{IN}], at stem:[D=0.5].
image::vout-to-vin-vs-duty-cycle-buck-boost.png[width=500px]

As the duty cycle approaches 100%, the ideal output voltage approaches infinity! In practise, non-idealities and component absolute maximums limit the the output voltage to something in the range of 10x the input voltage.

== SEPIC

=== Overview

SEPIC (single-ended primary inductance converter) is a switch-mode power supply (SMPS) which can both up and down-convert, similar to a buck/boost. It can be viewed as a boost converter followed by a buck-boost converter.

.The basic schematic of a SEPIC (single-ended primary inductance converter). Capacitor C1 is shown as polarized, but in some cases may be unpolarized to prevent problems if the voltage changes polarity (which can occur if the switch has a high duty cycle).
image::sepic-basic-schematic.svg[width=700px]

Like a <<Ćuk Converter>>, a SEPIC has one switch and two inductors. It's advantages over a buck-boost alone is that is has a non-inverted output voltage, DC decouplement from input to out (through a series power-transferring capacitor), which makes it easier to handle things such as short circuits on the output, and true turnoff of the output (when the switch is off, the output truly goes to 0V).

Like other SMPS, the SEPIC converter uses a switching element of control the output. The power transferring capacitor between input and output is sometimes called the **AC capacitor**.

=== Output Voltage

In continuous-conduction mode (CCM), the equation linking the input voltage stem:[V_{IN}], output voltage stem:[V_{OUT}] and duty cycle stem:[D] of a SEPIC is:

[stem]
++++
V_{OUT} = \frac{D}{1-D} V_{IN}
++++

Like before, this equation assumes all components are ideal. This equation is identical to the one for a inverting buck-boost except for the negative sign (a buck-boost inverts the output, while a SEPIC does not).

=== Inductor(s)

The SEPIC has two inductors, just like the <<Ćuk Converter>>. They can either be wound on separate cores and not share any magnetic field (_uncoupled inductors_), or be wound on the same core and share a magnetic field (a _coupled dual-winding inductor_). Using a coupled dual-winding inductor has the advantages of reducing the component count, and lowering the total inductance requirements, but can be hard to find for high-power requirements. Coupled inductors used in a SEPIC also benefit from some leakage inductance, which reduces the AC losses.

The equations are different for coupled and un-coupled inductor designs. For a coupled inductor, the equation to calculate the inductance stem:[L] is:

[stem]
++++
L = \frac{V_{IN}^2 d_{min}^2}{2f_s P_{OUT(min)}(1 + d_{min}\frac{1 - n}{n})}
++++

And for two uncoupled inductors:

[stem]
++++
L_1 = \frac{d_{min} V_{IN(max)}^2 n}{2f_s P_{OUT(min)}}
++++

[stem]
++++
L_2 = \frac{(1 - d_{min}) V_{OUT}^2}{2f_s P_{OUT(min)}}
++++

The above equations determines the minimum inductance required for CCM operation at maximum input voltage and minimum load (the worst-case scenario for a SEPIC).

NOTE: Even though the equations above show this, it is still worth pointing out that in an decoupled design, the inductances **do not have to be the same value**. This is a common misconception, this rule only applies to the coupled SEPIC design.

=== Capacitor

Sometimes the AC capacitor needs a series RC snubber circuit to make the SEPIC stable. A low resistance between 1-10R and a large capacitance between 50-1000uF can sometimes fix this.

=== Examples

The LT from Linear Technology can be used in a SEPIC configuration to control a series of high-power LEDs.

== Ćuk Converter

The _Ćuk converter_ is a buck-boost topology that only requires a single switch, but two inductors (just like the link:#_sepic[SEPIC]). It also has the additional property of 0 output ripple current when it's two inductors are coupled. It produces an output voltage which is opposite in polarity to the input (i.e. it is _inverting_).

**Advantages:**

* 0 output ripple current (when the two inductors are coupled).

**Disadvantages:**

* High current stress in the switch.
* Inverting (depending on the application, this could be an advantage!)